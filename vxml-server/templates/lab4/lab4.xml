<?xml version="1.0" encoding="utf-8"?>

<vxml version="2.1" xmlns="http://www.w3.org/2001/vxml"
      xmlns:voxeo="http://community.voxeo.com/xmlns/vxml">

  <link next="lab1">
  <grammar mode="voice" version="1.0" root="root">
    <rule id="root" scope="public">
       <one-of>
         <item>main menu</item>
	       <item> start over</item>
       </one-of>
    </rule>
  </grammar>
  </link>

  <nomatch>
    I didn't understand, try talking with an American accent.
    <reprompt/>
  </nomatch>
  
  <noinput>
    Speak up please!
    <reprompt/>
  </noinput>

  <!-- Data model -->
  <var name="confirm" />
  <var name="food" />
  <var name="seat"/>
  <var name="model"/>


  <!-- State machine -->
  <form id="welcome">
    <block>
      
      <prompt>
	    <break time="2000" />
	      Welcome to The Altered Beast flight booking service
      </prompt>
      <goto next="#flightBooking"/>
    </block>
  </form>

<!--
<menu id="mainMenu">
  <prompt>
    Main Menu, please choose from; flight booking service, delayed flights, or life advice.
  </prompt>
  <choice next="#flight_booking">
    Flight booking service
  </choice>
  <choice next="delayed_flights">
    delayed flights
  </choice>
  <choice next="life_advice">
    life advice
  </choice>
</menu>
-->

<form id="flightBooking">
  <field name="bookingSheet">
      <prompt count="1">
          Please answer the following.
          Where would you like to fly and from where are you departing.
      </prompt>
      <prompt count="2"> You can specifiy the city of departure and arrival, as well as the date </prompt>
      <prompt count="3"> Here is an example, I want to fly from London to Paris on the 22nd of July</prompt>
      <grammar src="grammars/lab4_grammar.xml"/>
  </field>
  <filled>
    <if cond="bookingSheet$.interpretation.flyFrom == bookingSheet$.interpretation.flyTo">
      <prompt>
        Your destination and departure can not be the same. Try again
      </prompt>
      <goto next="#flightBooking"/>
    <else/>
      <prompt>
      nice!
      <value expr="bookingSheet$.interpretation.statement"/>
      from
      <value expr="bookingSheet$.interpretation.flyFrom"/>
      to
      <value expr="bookingSheet$.interpretation.flyTo"/>
      on the 
      <value expr="bookingSheet$.interpretation.number"/>
      of 
      <value expr="bookingSheet$.interpretation.month"/>       
      </prompt>
      <goto next="#confirmation"/> 
    
    </if>
  </filled>
  </form>

  <form id ="confirmation">
    <field name="con">
      <prompt>
        Is that Correct?      
      </prompt>
      <option>yes</option>
      <option>No</option>
      <filled>
        <assign name="confirm" expr="con"/>
        <if cond="confirm =='yes'">
          <prompt>
            Great lets take you to the extras
          </prompt>
          <goto next = "#extras"/>
        <else>
          <prompt>
            We will try again
          </prompt>
          <goto next="#bookingSheet"/>
        </else>
        </if>
      </filled>
    </field>
  </form>

  <form id="extras">
    <field id="meal">
      <prompt>
        Please answer the following.
        What meal would you like?
      </prompt>
      <prompt count="2">
        You can choose from Vegetarian, vegan or cruel option
      </prompt>
      <grammar src="grammars/lab4_grammar.xml#flightMeal"/>
    </field>
    <filled>
      <assign name="food" expr="meal"/>
    </filled>

    <field id="insideOutside">
      <prompt>
        Would you like to sit inside our oustide the plane?
      </prompt>
      <grammar src="grammars/lab4_grammar.xml#insideOutside"/>
    </field>
    <filled>
      <assign name="seat" expr="insideOutside"/>
    </filled>

    <field id="plane">
      <prompt>
        What make of plane would you like.
      </prompt> 
      <prompt count="2">
        We currently have 747, Conchord, Hot air balloon and helicopter. We no longer
        run the 747 Max 
      </prompt>
      <grammar src="grammars/lab4_grammar.xml#planeType"/>
    </field>
    <filled>
      <assign name="model" expr="plane"/>
    </filled>

    <filled>
      <prompt>
        Your Extras are as follows, you are having the 
        <value expr="food"/> and you are 
        traveling by <value expr="model"/>
        <if cond="seat = 'outside'">
          <prompt>
            and you are strangely enough sitting on the outside, good luck with that
          </prompt>
        <else/>
          <prompt>
            And luckily you are sitting inside the plane.
          </prompt>
        </if>
      </prompt>
    </filled>
  </form>

</vxml>
